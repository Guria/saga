# Tests for numeric data types.
#
# FIXME: Gradient aims to use IEEE 64-bit doubles for all numeric values,
# but has known bugs. Tests currently cover the historical behaviour, but
# tests for the correct behaviour are commented out with FIXME tags. See:
# https://github.com/sanity-io/gradient/issues/553
# https://github.com/sanity-io/gradient/issues/554
title: "Datatype: numeric"
documents:
- _id: "decimals"
  _type: "test"
  value: [-3.14, 0, 3.14]
- _id: "decimals-scientific"
  _type: "test"
  value: [
    3.14e17,
    3.14e-17,
    3.14e100,
    3.14e-100,
    -3.14e17,
    -3.14e-17,
    -3.14e100,
    -3.14e-100,

    3.14e2,
    3.14e0,
    3.14e-2,
    -3.14e2,
    -3.14e0,
    -3.14e-2,

    0.0314e2,
    0.0314e-2,
    -0.0314e2,
    -0.0314e-2,

    314e2,
    314e-2,
    -314e2,
    -314e-2,

    3.14E2,
    3.14E0,
    3.14E-2,
    -3.14E2,
    -3.14E0,
    -3.14E-2,

    3.14e+2,
    3.14e+0,
    3.14e-0,
    -3.14e+2,
    -3.14e+0,
    -3.14e-0,

    3.14e+002,
    3.14e002,
    3.14e000,
    3.14e-000,
    3.14e-002,
    -3.14e+002,
    -3.14e002,
    -3.14e000,
    -3.14e-000,
    -3.14e-002,

    0e0,
    0e1,
    0e10,
    0e-0,
    0e-1,
    0e-10,
  ]
- _id: "decimals-15-sigfig-boundaries"
  _type: "test"
  value: [
      -0.00000000001234567890123450000000000,
      -0.00000000001234567890123456780000000,
      -123456789.012345678000000,
      -123456789.012345000000000,
      -123456789012345678000000.0,
      -123456789012345000000000.0,
      0.00000000001234567890123450000000000,
      0.00000000001234567890123456780000000,
      123456789.012345000000000,
      123456789.012345678000000,
      123456789012345678000000.0,
      123456789012345000000000.0,
  ]
- _id: "integers"
  _type: "test"
  value: [-1, 0, 1]
- _id: "integers-15-sigfig-boundaries"
  _type: "test"
  value: [
    -1234567890123456780000000,
    -1234567890123450000000000,
    1234567890123450000000000,
    1234567890123456780000000
  ]
- _id: "integers-53-bit-boundaries"
  _type: "test"
  value: [
    -9007199254740994,
    -9007199254740993,
    -9007199254740992,
    -9007199254740991,
    9007199254740991,
    9007199254740992,
    9007199254740993,
    9007199254740994
  ]
- _id: "integers-64-bit-boundaries"
  _type: "test"
  value: [
    -10000000000000000000,
    -9223372036854775807,
    9223372036854775807,
    10000000000000000000
  ]
- _id: "integers-double-boundaries"
  _type: "test"
  value: [
    -180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
    -170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
    170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
    180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  ]

tests:
- title: "Decimal attributes"
  query: |
    * [ _id == "decimals" ][0].value
  result: [-3.14, 0, 3.14]
- title: "Decimal attributes 15 sigfig boundaries"
  query: |
    * [ _id == "decimals-15-sigfig-boundaries" ][0].value
  result: [
    -0.0000000000123456789012345,
    -0.000000000012345678901234568,
    -123456789.01234567,
    -123456789.012345,
    -123456789012345690000000,
    -123456789012345000000000,
    0.0000000000123456789012345,
    0.000000000012345678901234568,
    123456789.012345,
    123456789.01234567,
    123456789012345690000000,
    123456789012345000000000
  ]
- title: "Decimal attributes scientific"
  query: |
    * [ _id == "decimals-scientific" ][0].value
  result: [
    314000000000000000,
    3.14e-17,
    3.14e+100,
    3.14e-100,
    -314000000000000000,
    -3.14e-17,
    -3.14e+100,
    -3.14e-100,
    314,
    3.14,
    0.0314,
    -314,
    -3.14,
    -0.0314,
    3.14,
    0.000314,
    -3.14,
    -0.000314,
    31400,
    3.14,
    -31400,
    -3.14,
    314,
    3.14,
    0.0314,
    -314,
    -3.14,
    -0.0314,
    314,
    3.14,
    3.14,
    -314,
    -3.14,
    -3.14,
    314,
    314,
    3.14,
    3.14,
    0.0314,
    -314,
    -314,
    -3.14,
    -3.14,
    -0.0314,
    0,
    0,
    0,
    0,
    0,
    0,
  ]
- title: "Integer attributes"
  query: |
    * [ _id == "integers" ][0].value
  result: [-1, 0, 1]
- title: "Integer attributes 15 sigfig boundaries"
  query: |
    * [ _id == "integers-15-sigfig-boundaries" ][0].value
  result: [
    -1234567890123456800000000,
    -1234567890123450000000000,
    1234567890123450000000000,
    1234567890123456800000000
  ]
- title: "Integer attributes 53-bit boundaries"
  query: |
    * [ _id == "integers-53-bit-boundaries" ][0].value
  result: [
    -9007199254740994,
    -9007199254740993,
    -9007199254740992,
    -9007199254740991,
    9007199254740991,
    9007199254740992,
    9007199254740993,
    9007199254740994
  ]
- title: "Integer attributes 64-bit boundaries"
  query: |
    * [ _id == "integers-64-bit-boundaries" ][0].value
  result: [
    # FIXME These should not be returned as strings. Correct values commented out.
    #-10000000000000000000,
    #-9223372036854776000,
    #9223372036854776000,
    #10000000000000000000
    "-10000000000000000000",
    "-9223372036854776000",
    "9223372036854776000",
    "10000000000000000000"
  ]
- title: "Integer attributes double boundaries"
  query: |
    * [ _id == "integers-double-boundaries" ][0].value
  result: [
    # FIXME Should these really be returned in this format?
    # Possibly correct values commented out. Use null for overflow/underflow?
    #null,
    #-170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
    #170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
    #null
    null,
    -1.7e+308,
    1.7e+308,
    null
  ]

- title: "Decimal literals"
  query: |
    [-3.14, 0, 3.14]
  result: [-3.14, 0, 3.14]
- title: "Decimal literals 15 sigfig boundaries"
  query: |
    [
      -0.00000000001234567890123450000000000,
      -0.00000000001234567890123456780000000,
      -123456789.012345678000000,
      -123456789.012345000000000,
      -123456789012345678000000.0,
      -123456789012345000000000.0,
      0.00000000001234567890123450000000000,
      0.00000000001234567890123456780000000,
      123456789.012345000000000,
      123456789.012345678000000,
      123456789012345678000000.0,
      123456789012345000000000.0
    ]
  result: [
    -0.0000000000123456789012345,
    -0.000000000012345678901234568,
    -123456789.01234567,
    -123456789.012345,
    -123456789012345690000000,
    -123456789012345000000000,
    0.0000000000123456789012345,
    0.000000000012345678901234568,
    123456789.012345,
    123456789.01234567,
    123456789012345690000000,
    123456789012345000000000
  ]
- title: "Decimals literals scientific notation"
  query: |
    [
      3.14e17,
      3.14e-17,
      3.14e100,
      3.14e-100,
      -3.14e17,
      -3.14e-17,
      -3.14e100,
      -3.14e-100,

      3.14e2,
      3.14e0,
      3.14e-2,
      -3.14e2,
      -3.14e0,
      -3.14e-2,

      0.0314e2,
      0.0314e-2,
      -0.0314e2,
      -0.0314e-2,

      314e2,
      314e-2,
      -314e2,
      -314e-2,

      3.14E2,
      3.14E0,
      3.14E-2,
      -3.14E2,
      -3.14E0,
      -3.14E-2,

      3.14e+2,
      3.14e+0,
      3.14e-0,
      -3.14e+2,
      -3.14e+0,
      -3.14e-0,

      3.14e+002,
      3.14e002,
      3.14e000,
      3.14e-000,
      3.14e-002,
      -3.14e+002,
      -3.14e002,
      -3.14e000,
      -3.14e-000,
      -3.14e-002,

      0e0,
      0e1,
      0e10,
      0e-0,
      0e-1,
      0e-10,
    ]
  result: [
    314000000000000000,
    3.14e-17,
    3.14e+100,
    3.14e-100,
    -314000000000000000,
    -3.14e-17,
    -3.14e+100,
    -3.14e-100,
    314,
    3.14,
    0.0314,
    -314,
    -3.14,
    -0.0314,
    3.14,
    0.000314,
    -3.14,
    -0.000314,
    31400,
    3.14,
    -31400,
    -3.14,
    314,
    3.14,
    0.0314,
    -314,
    -3.14,
    -0.0314,
    314,
    3.14,
    3.14,
    -314,
    -3.14,
    -3.14,
    314,
    314,
    3.14,
    3.14,
    0.0314,
    -314,
    -314,
    -3.14,
    -3.14,
    -0.0314,
    0,
    0,
    0,
    0,
    0,
    0,
  ]
- title: "Integer literals"
  query: |
    [-1, 0, 1]
  result: [-1, 0, 1]
- title: "Integer literals 15 sigfig boundaries"
  query: |
    [
      -1234567890123456780000000.0000000000,
      -1234567890123450000000000.0000000000,
      1234567890123450000000000.0000000000,
      1234567890123456780000000.0000000000
    ]
  result: [
    -1234567890123456800000000,
    -1234567890123450000000000,
    1234567890123450000000000,
    1234567890123456800000000
  ]
- title: "Integer literals 53-bit boundaries"
  query: |
    [
      -9007199254740994,
      -9007199254740993,
      -9007199254740992,
      -9007199254740991,
      9007199254740991,
      9007199254740992,
      9007199254740993,
      9007199254740994
    ]
  result: [
    -9007199254740994,
    -9007199254740992,
    -9007199254740992,
    -9007199254740991,
    9007199254740991,
    9007199254740992,
    9007199254740992,
    9007199254740994
  ]
- title: "Integer literals 64-bit boundaries"
  query: |
    [
      -10000000000000000000,
      -9223372036854775808,
      9223372036854775807,
      10000000000000000000
    ]
  result: [
    # FIXME should not be truncated at the 64-bit integer boundary,
    # correct values commented out.
    #-10000000000000000000,
    #-9223372036854776000,
    #9223372036854776000,
    #10000000000000000000
    -9223372036854776000,
    -9223372036854776000,
    9223372036854776000,
    9223372036854776000
  ]

# FIXME: Something wrong with the number formate of the parser atm? Seems to be using 32 bit values
- title: "Integer literals double boundaries"
  query: |
    [
      -180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
      -170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
      170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
      180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    ]
  result: [
    # FIXME should not be truncated at the 64-bit integer boundary,
    # correct values commented out.
    #-180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
    #-170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
    #170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000,
    #180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    -9223372036854776000,
    -9223372036854776000,
    9223372036854776000,
    9223372036854776000
  ]